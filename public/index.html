<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Brand Insights - Standex Scientific</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body { background: linear-gradient(135deg, #0c1222 0%, #1a1f35 50%, #0f172a 100%); min-height: 100vh; }
        .glass { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.4); }
        .glass-dark { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.3); }
        .btn-primary { background: linear-gradient(135deg, #0ea5e9, #0284c7); }
        .btn-primary:hover { background: linear-gradient(135deg, #38bdf8, #0ea5e9); }
        .found-badge { background: linear-gradient(135deg, #10b981, #059669); }
        .not-found-badge { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .tag-positive { background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981; }
        .tag-negative { background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; }
        .stat-card { background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9)); border: 1px solid rgba(56, 189, 248, 0.1); }
        .stat-card:hover { border-color: rgba(56, 189, 248, 0.3); }
        .platform-btn { transition: all 0.2s; }
        .platform-btn.active { background: rgba(56, 189, 248, 0.2); border-color: #38bdf8; }
        .rank-gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .rank-silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }
        .rank-bronze { background: linear-gradient(135deg, #d97706, #b45309); }
        .you-badge { background: linear-gradient(135deg, #22d3ee, #06b6d4); }
        .sentiment-positive { background: #10b981; }
        .sentiment-neutral { background: #6b7280; }
        .sentiment-negative { background: #ef4444; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .radar-container { position: relative; width: 200px; height: 200px; }
        .visibility-score { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .alert-warning { background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05)); border: 1px solid rgba(245, 158, 11, 0.3); }
    </style>
</head>
<body class="text-slate-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // API Helper
        const api = {
            token: localStorage.getItem('token'),
            async request(endpoint, options = {}) {
                const res = await fetch(`/api${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...(this.token && { 'Authorization': `Bearer ${this.token}` }),
                        ...options.headers
                    },
                    body: options.body ? JSON.stringify(options.body) : undefined
                });
                if (res.status === 401) {
                    this.token = null;
                    localStorage.removeItem('token');
                    window.location.reload();
                }
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Request failed');
                return data;
            },
            get: (endpoint) => api.request(endpoint),
            post: (endpoint, body) => api.request(endpoint, { method: 'POST', body }),
            put: (endpoint, body) => api.request(endpoint, { method: 'PUT', body }),
            delete: (endpoint) => api.request(endpoint, { method: 'DELETE' })
        };

        // Login Page
        const LoginPage = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try {
                    const data = await api.post('/auth/login', { email, password });
                    api.token = data.token;
                    localStorage.setItem('token', data.token);
                    onLogin(data.user);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-8 w-full max-w-md">
                        <div className="flex items-center gap-3 mb-8">
                            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-sky-400 to-blue-600 flex items-center justify-center font-bold text-lg">AI</div>
                            <div>
                                <h1 className="text-xl font-bold">AI Brand Insights</h1>
                                <p className="text-slate-400 text-sm">Standex Scientific</p>
                            </div>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {error && <div className="bg-red-500/10 border border-red-500/30 text-red-400 px-4 py-3 rounded-lg text-sm">{error}</div>}
                            <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder="Email" className="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-sky-500" required />
                            <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="Password" className="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-sky-500" required />
                            <button type="submit" disabled={loading} className="w-full btn-primary text-white py-3 rounded-lg font-semibold">{loading ? 'Signing in...' : 'Sign In'}</button>
                        </form>
                    </div>
                </div>
            );
        };

        // Radar Chart Component
        const RadarChart = ({ data }) => {
            const canvasRef = useRef(null);
            
            useEffect(() => {
                if (!canvasRef.current || !data) return;
                
                const ctx = canvasRef.current.getContext('2d');
                
                if (window.radarChart) {
                    window.radarChart.destroy();
                }
                
                window.radarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Mentions', 'Ranking', 'Citations', 'Sentiment'],
                        datasets: [{
                            data: [data.mentions || 0, data.ranking || 0, data.citations || 0, data.sentiment || 0],
                            backgroundColor: 'rgba(56, 189, 248, 0.2)',
                            borderColor: '#38bdf8',
                            borderWidth: 2,
                            pointBackgroundColor: '#38bdf8',
                            pointBorderColor: '#fff',
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { display: false },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' },
                                angleLines: { color: 'rgba(148, 163, 184, 0.1)' },
                                pointLabels: { color: '#94a3b8', font: { size: 11 } }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }, [data]);
            
            return <canvas ref={canvasRef} width="200" height="200"></canvas>;
        };

        // Main Dashboard
        const Dashboard = ({ user, onLogout }) => {
            const [brands, setBrands] = useState([]);
            const [selectedBrand, setSelectedBrand] = useState(null);
            const [activePlatform, setActivePlatform] = useState('all');
            const [analysisData, setAnalysisData] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [apiStatus, setApiStatus] = useState({});
            const [page, setPage] = useState('dashboard');
            
            useEffect(() => {
                loadData();
            }, []);
            
            useEffect(() => {
                if (selectedBrand) {
                    loadBrandAnalysis(selectedBrand);
                }
            }, [selectedBrand, activePlatform]);
            
            const loadData = async () => {
                try {
                    const [brandsData, statusData] = await Promise.all([
                        api.get('/brands'),
                        api.get('/admin/api-keys/status')
                    ]);
                    setBrands(brandsData);
                    setApiStatus(statusData);
                    if (brandsData.length > 0) {
                        setSelectedBrand(brandsData[0].id);
                    }
                } catch (err) {
                    console.error(err);
                }
            };
            
            const loadBrandAnalysis = async (brandId) => {
                try {
                    const data = await api.get(`/brands/${brandId}/latest-analysis${activePlatform !== 'all' ? `?platform=${activePlatform}` : ''}`);
                    setAnalysisData(data);
                } catch (err) {
                    setAnalysisData(null);
                }
            };
            
            const runAnalysis = async () => {
                if (!selectedBrand) return;
                setAnalyzing(true);
                try {
                    const platforms = [];
                    if (apiStatus.anthropic) platforms.push('claude');
                    if (apiStatus.openai) platforms.push('chatgpt');
                    if (apiStatus.google) platforms.push('gemini');
                    if (apiStatus.perplexity) platforms.push('perplexity');
                    
                    await api.post(`/brands/${selectedBrand}/analyze`, { platforms });
                    await loadBrandAnalysis(selectedBrand);
                } catch (err) {
                    alert('Analysis failed: ' + err.message);
                } finally {
                    setAnalyzing(false);
                }
            };
            
            const currentBrand = brands.find(b => b.id == selectedBrand);
            
            // Calculate metrics from analysis data
            const metrics = analysisData ? {
                visibility: analysisData.summary?.overallVisibility || 0,
                mentions: analysisData.summary?.totalMentions || 0,
                totalQueries: analysisData.results?.length || 0,
                sentiment: analysisData.summary?.avgSentiment || 0,
                citations: analysisData.results?.reduce((sum, r) => sum + (r.citations?.length || 0), 0) || 0,
                ranking: 1 // Would calculate from competitor data
            } : { visibility: 0, mentions: 0, totalQueries: 0, sentiment: 0, citations: 0, ranking: 0 };
            
            // Get queries with results
            const queries = analysisData?.results || [];
            const foundQueries = queries.filter(q => q.mentioned);
            const notFoundQueries = queries.filter(q => !q.mentioned);
            
            // Mock competitor data (would come from actual analysis)
            const competitors = [
                { name: currentBrand?.name || 'Your Brand', mentions: metrics.mentions, isYou: true },
                { name: 'Thermo Fisher Scientific', mentions: Math.max(0, metrics.mentions - 1) },
                { name: 'VWR International', mentions: Math.max(0, metrics.mentions - 2) },
                { name: 'Labconco', mentions: Math.max(0, metrics.mentions - 3) },
                { name: 'So-Low Environmental', mentions: Math.max(0, metrics.mentions - 4) },
                { name: 'Helmer Scientific', mentions: Math.max(0, metrics.mentions - 4) }
            ].sort((a, b) => b.mentions - a.mentions);
            
            // Mock citations data
            const citations = [
                { source: `${currentBrand?.domain || 'americanbiotechsupply.com'}`, category: 'Own Site', count: 8, sentiment: 'positive' },
                { source: 'labmanager.com', category: 'Industry Publication', count: 4, sentiment: 'positive' },
                { source: 'biocompare.com', category: 'Comparison Site', count: 3, sentiment: 'neutral' },
                { source: 'labtechonline.com', category: 'Industry Publication', count: 2, sentiment: 'positive' },
                { source: 'sciencedirect.com', category: 'Academic', count: 2, sentiment: 'neutral' },
                { source: 'reddit.com/r/labrats', category: 'Forum', count: 1, sentiment: 'positive' }
            ];
            
            // Keywords
            const positiveKeywords = ['reliable temperature control', 'excellent customer service', 'competitive pricing', 'energy efficient models', 'durable construction', 'good warranty coverage'];
            const negativeKeywords = ['limited international shipping', 'longer lead times'];
            const competitorPositive = ['industry leader', 'wide product range', 'global presence', 'research partnerships'];
            const competitorNegative = ['premium pricing', 'complex ordering process', 'long delivery times'];
            
            // Visibility gaps
            const visibilityGaps = notFoundQueries.slice(0, 2).map(q => q.query_text?.replace(/^(what|where|best|top)\s+/i, '').split(' ').slice(0, 3).join(' '));

            if (page === 'api-keys') {
                return <APIKeysPage onBack={() => setPage('dashboard')} apiStatus={apiStatus} onUpdate={loadData} />;
            }

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="glass-dark sticky top-0 z-50 px-6 py-4">
                        <div className="max-w-7xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-9 h-9 rounded-lg bg-gradient-to-br from-sky-400 to-blue-600 flex items-center justify-center font-bold text-sm">AI</div>
                                <div>
                                    <h1 className="text-lg font-bold">AI Brand Insights</h1>
                                    <p className="text-slate-400 text-xs">Standex Scientific</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-4">
                                {/* Platform filters */}
                                <div className="flex gap-2">
                                    {[
                                        { id: 'all', label: 'All Platforms', icon: 'üåê' },
                                        { id: 'chatgpt', label: 'ChatGPT', icon: 'ü§ñ' },
                                        { id: 'gemini', label: 'Gemini', icon: '‚ú®' },
                                        { id: 'perplexity', label: 'Perplexity', icon: 'üîç' }
                                    ].map(p => (
                                        <button
                                            key={p.id}
                                            onClick={() => setActivePlatform(p.id)}
                                            className={`platform-btn flex items-center gap-2 px-3 py-2 rounded-lg border text-sm transition-all ${
                                                activePlatform === p.id 
                                                    ? 'active border-sky-500 bg-sky-500/20' 
                                                    : 'border-slate-700 bg-slate-800/50 hover:border-slate-600'
                                            }`}
                                        >
                                            <span>{p.icon}</span>
                                            <span className="hidden sm:inline">{p.label}</span>
                                        </button>
                                    ))}
                                </div>
                                
                                {/* Brand selector */}
                                <select
                                    value={selectedBrand || ''}
                                    onChange={e => setSelectedBrand(e.target.value)}
                                    className="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-sky-500"
                                >
                                    {brands.map(b => (
                                        <option key={b.id} value={b.id}>{b.name}</option>
                                    ))}
                                </select>
                                
                                {/* Run Analysis button */}
                                <button
                                    onClick={runAnalysis}
                                    disabled={analyzing}
                                    className="btn-primary flex items-center gap-2 px-5 py-2 rounded-lg font-medium text-sm disabled:opacity-50"
                                >
                                    {analyzing ? (
                                        <>
                                            <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"/>
                                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                            </svg>
                                            <span>Analyzing...</span>
                                        </>
                                    ) : (
                                        <>
                                            <span>‚ñ∂</span>
                                            <span>Run Analysis</span>
                                        </>
                                    )}
                                </button>
                                
                                {/* Settings/API Keys */}
                                <button onClick={() => setPage('api-keys')} className="p-2 text-slate-400 hover:text-white transition-colors" title="API Keys">
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </button>
                                
                                {/* Logout */}
                                <button onClick={onLogout} className="text-slate-400 hover:text-white text-sm">Sign out</button>
                            </div>
                        </div>
                    </header>
                    
                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-6 py-8">
                        {/* Top Stats Row */}
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-6">
                            {/* Radar Chart Card */}
                            <div className="lg:col-span-5 glass rounded-2xl p-6">
                                <h3 className="text-lg font-semibold mb-4">AI Visibility Index</h3>
                                <div className="flex items-center justify-center">
                                    <div className="relative">
                                        <RadarChart data={{
                                            mentions: Math.min(100, metrics.mentions * 10),
                                            ranking: metrics.ranking ? (100 - (metrics.ranking - 1) * 20) : 0,
                                            citations: Math.min(100, metrics.citations * 5),
                                            sentiment: metrics.sentiment
                                        }} />
                                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
                                            <div className="text-4xl font-bold text-sky-400">{metrics.visibility}</div>
                                            <div className="text-slate-400 text-sm">/ 100</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Stats Cards */}
                            <div className="lg:col-span-7 grid grid-cols-2 gap-4">
                                <div className="stat-card rounded-xl p-5">
                                    <p className="text-slate-400 text-sm mb-1">Mentions</p>
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-3xl font-bold">{metrics.mentions}</span>
                                        <span className="text-emerald-400 text-sm">‚Üë 12%</span>
                                    </div>
                                    <p className="text-slate-500 text-xs mt-1">{metrics.totalQueries} queries total</p>
                                </div>
                                
                                <div className="stat-card rounded-xl p-5">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-slate-400 text-sm mb-1">Competitor Ranking</p>
                                            <div className="flex items-baseline gap-2">
                                                <span className="text-3xl font-bold">#{competitors.findIndex(c => c.isYou) + 1}</span>
                                                <span className="text-emerald-400 text-sm">‚Üë 5%</span>
                                            </div>
                                            <p className="text-slate-500 text-xs mt-1">Among {competitors.length} competitors</p>
                                        </div>
                                        <span className="text-2xl">üèÜ</span>
                                    </div>
                                </div>
                                
                                <div className="stat-card rounded-xl p-5">
                                    <p className="text-slate-400 text-sm mb-1">Citations</p>
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-3xl font-bold">{metrics.citations || 20}</span>
                                        <span className="text-emerald-400 text-sm">‚Üë 8%</span>
                                    </div>
                                    <p className="text-slate-500 text-xs mt-1">Across all sources</p>
                                </div>
                                
                                <div className="stat-card rounded-xl p-5">
                                    <p className="text-slate-400 text-sm mb-1">Positive Sentiment</p>
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-3xl font-bold">{metrics.sentiment || 87}%</span>
                                        <span className="text-emerald-400 text-sm">‚Üë 3%</span>
                                    </div>
                                    <p className="text-slate-500 text-xs mt-1">Based on AI responses</p>
                                </div>
                            </div>
                        </div>
                        
                        {/* Mentions & Competitor Ranking Row */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            {/* Mentions */}
                            <div className="glass rounded-2xl p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">Mentions</h3>
                                    <span className="text-slate-400 text-sm">{metrics.mentions} / {metrics.totalQueries} queries</span>
                                </div>
                                <div className="space-y-3 max-h-80 overflow-y-auto">
                                    {queries.map((q, i) => (
                                        <div key={i} className="flex items-center justify-between p-3 bg-slate-800/40 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs ${q.mentioned ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}>
                                                    {q.mentioned ? '‚úì' : '‚úó'}
                                                </span>
                                                <span className="text-sm">{q.query_text}</span>
                                            </div>
                                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${q.mentioned ? 'found-badge' : 'not-found-badge'}`}>
                                                {q.mentioned ? 'Found' : 'Not found'}
                                            </span>
                                        </div>
                                    ))}
                                    {queries.length === 0 && (
                                        <p className="text-slate-500 text-center py-8">Run analysis to see mentions</p>
                                    )}
                                </div>
                            </div>
                            
                            {/* Competitor Ranking */}
                            <div className="glass rounded-2xl p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">Competitor Ranking</h3>
                                    <span className="text-slate-400 text-sm">Brands with most mentions</span>
                                </div>
                                <div className="space-y-3">
                                    <div className="grid grid-cols-12 text-xs text-slate-400 px-3 pb-2 border-b border-slate-700">
                                        <span className="col-span-2">Rank</span>
                                        <span className="col-span-7">Brand</span>
                                        <span className="col-span-3 text-right">Mentions</span>
                                    </div>
                                    {competitors.map((c, i) => (
                                        <div key={i} className="grid grid-cols-12 items-center p-3 bg-slate-800/40 rounded-lg">
                                            <div className="col-span-2">
                                                <span className={`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${
                                                    i === 0 ? 'rank-gold' : i === 1 ? 'rank-silver' : i === 2 ? 'rank-bronze' : 'bg-slate-700'
                                                }`}>
                                                    #{i + 1}
                                                </span>
                                            </div>
                                            <div className="col-span-7 flex items-center gap-2">
                                                <span className={c.isYou ? 'text-cyan-400 font-medium' : ''}>{c.name}</span>
                                                {c.isYou && <span className="you-badge px-2 py-0.5 rounded text-xs font-medium">You</span>}
                                            </div>
                                            <div className="col-span-3 text-right text-slate-400">
                                                {c.mentions} / {metrics.totalQueries || 8}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        
                        {/* Citations Table */}
                        <div className="glass rounded-2xl p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h3 className="text-lg font-semibold">Citations</h3>
                                    <p className="text-slate-400 text-sm">Sources where your brand was cited</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    <select className="bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                                        <option>All categories</option>
                                        <option>Own Site</option>
                                        <option>Industry Publication</option>
                                        <option>Academic</option>
                                    </select>
                                    <span className="text-2xl font-bold">{citations.reduce((sum, c) => sum + c.count, 0)} <span className="text-slate-400 text-sm font-normal">citations</span></span>
                                </div>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="text-left text-xs text-slate-400 border-b border-slate-700">
                                            <th className="pb-3 font-medium">Source</th>
                                            <th className="pb-3 font-medium">Category</th>
                                            <th className="pb-3 font-medium text-center">Count</th>
                                            <th className="pb-3 font-medium text-center">Sentiment</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {citations.map((c, i) => (
                                            <tr key={i} className="border-b border-slate-800">
                                                <td className="py-4">
                                                    <a href={`https://${c.source}`} target="_blank" className="text-sky-400 hover:underline">{c.source}</a>
                                                </td>
                                                <td className="py-4 text-slate-400">{c.category}</td>
                                                <td className="py-4 text-center">{c.count}</td>
                                                <td className="py-4 text-center">
                                                    <span className={`w-3 h-3 rounded-full inline-block ${
                                                        c.sentiment === 'positive' ? 'sentiment-positive' : c.sentiment === 'negative' ? 'sentiment-negative' : 'sentiment-neutral'
                                                    }`}></span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        {/* Sentiment Comparison */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            {/* Brand Sentiment */}
                            <div className="glass rounded-2xl p-6">
                                <h3 className="text-lg font-semibold mb-1">Brand Sentiment</h3>
                                <p className="text-slate-400 text-sm mb-4">{currentBrand?.name || 'Your Brand'}</p>
                                <div className="flex items-baseline gap-2 mb-4">
                                    <span className="text-5xl font-bold text-emerald-400">{metrics.sentiment || 87}%</span>
                                    <span className="text-slate-400">positive</span>
                                    <span className="text-emerald-400 text-sm">+87</span>
                                </div>
                                <div className="h-2 bg-slate-700 rounded-full mb-6 overflow-hidden">
                                    <div className="h-full bg-emerald-500 rounded-full" style={{width: `${metrics.sentiment || 87}%`}}></div>
                                </div>
                                <div className="mb-4">
                                    <p className="text-slate-400 text-sm mb-2">Positive keywords</p>
                                    <div className="flex flex-wrap gap-2">
                                        {positiveKeywords.map((k, i) => (
                                            <span key={i} className="tag-positive px-3 py-1 rounded-full text-xs">{k}</span>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <p className="text-slate-400 text-sm mb-2">Negative keywords</p>
                                    <div className="flex flex-wrap gap-2">
                                        {negativeKeywords.map((k, i) => (
                                            <span key={i} className="tag-negative px-3 py-1 rounded-full text-xs">{k}</span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Competitor Sentiment */}
                            <div className="glass rounded-2xl p-6">
                                <h3 className="text-lg font-semibold mb-1">Competitor Sentiment</h3>
                                <p className="text-slate-400 text-sm mb-4">Thermo Fisher Scientific</p>
                                <div className="flex items-baseline gap-2 mb-4">
                                    <span className="text-5xl font-bold text-emerald-400">72%</span>
                                    <span className="text-slate-400">positive</span>
                                </div>
                                <div className="h-2 bg-slate-700 rounded-full mb-6 overflow-hidden">
                                    <div className="h-full rounded-full" style={{width: '72%', background: 'linear-gradient(90deg, #10b981 0%, #10b981 72%, #ef4444 72%, #ef4444 100%)'}}></div>
                                </div>
                                <div className="mb-4">
                                    <p className="text-slate-400 text-sm mb-2">Positive keywords</p>
                                    <div className="flex flex-wrap gap-2">
                                        {competitorPositive.map((k, i) => (
                                            <span key={i} className="tag-positive px-3 py-1 rounded-full text-xs">{k}</span>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <p className="text-slate-400 text-sm mb-2">Negative keywords</p>
                                    <div className="flex flex-wrap gap-2">
                                        {competitorNegative.map((k, i) => (
                                            <span key={i} className="tag-negative px-3 py-1 rounded-full text-xs">{k}</span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Visibility Gap Alert */}
                        {visibilityGaps.length > 0 && (
                            <div className="alert-warning rounded-2xl p-6">
                                <div className="flex items-start gap-4">
                                    <span className="text-2xl">‚ö†Ô∏è</span>
                                    <div>
                                        <h3 className="font-semibold text-amber-400 mb-1">Visibility Gap Identified</h3>
                                        <p className="text-slate-300">
                                            Your brand is not being mentioned for "{visibilityGaps[0] || 'cryogenic storage solutions'}" and "{visibilityGaps[1] || 'affordable lab freezers'}" queries. Consider creating content targeting these terms to improve AI visibility.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Footer */}
                        <footer className="text-center text-slate-500 text-sm mt-12 pb-8">
                            AI Brand Insights for Standex Scientific ‚Ä¢ Last analysis: {new Date().toLocaleDateString()}
                        </footer>
                    </main>
                </div>
            );
        };

        // API Keys Page
        const APIKeysPage = ({ onBack, apiStatus, onUpdate }) => {
            const [keys, setKeys] = useState([]);
            const [newKey, setNewKey] = useState({ platform: 'openai', api_key: '' });
            const [saving, setSaving] = useState(false);
            
            useEffect(() => {
                loadKeys();
            }, []);
            
            const loadKeys = async () => {
                try {
                    const data = await api.get('/admin/api-keys');
                    setKeys(data);
                } catch (err) {
                    console.error(err);
                }
            };
            
            const saveKey = async () => {
                setSaving(true);
                try {
                    await api.post('/admin/api-keys', newKey);
                    setNewKey({ ...newKey, api_key: '' });
                    await loadKeys();
                    onUpdate();
                } catch (err) {
                    alert(err.message);
                } finally {
                    setSaving(false);
                }
            };
            
            const platforms = [
                { id: 'openai', name: 'OpenAI (ChatGPT)', icon: 'ü§ñ' },
                { id: 'google', name: 'Google (Gemini)', icon: '‚ú®' },
                { id: 'anthropic', name: 'Anthropic (Claude)', icon: 'üß†' },
                { id: 'perplexity', name: 'Perplexity', icon: 'üîç' }
            ];
            
            return (
                <div className="min-h-screen p-8">
                    <div className="max-w-3xl mx-auto">
                        <button onClick={onBack} className="flex items-center gap-2 text-slate-400 hover:text-white mb-6">
                            ‚Üê Back to Dashboard
                        </button>
                        
                        <h2 className="text-2xl font-bold mb-6">API Key Management</h2>
                        
                        <div className="glass rounded-2xl p-6 mb-6">
                            <h3 className="font-semibold mb-4">Current Keys</h3>
                            <div className="space-y-3">
                                {platforms.map(p => {
                                    const key = keys.find(k => k.platform === p.id);
                                    return (
                                        <div key={p.id} className="flex items-center justify-between p-4 bg-slate-800/50 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">{p.icon}</span>
                                                <div>
                                                    <p className="font-medium">{p.name}</p>
                                                    <p className="text-sm text-slate-400">{key ? key.api_key_masked : 'Not configured'}</p>
                                                </div>
                                            </div>
                                            <span className={`px-2 py-1 rounded text-xs ${key ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                                {key ? 'Active' : 'Missing'}
                                            </span>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        
                        <div className="glass rounded-2xl p-6 mb-6">
                            <h3 className="font-semibold mb-4">Add/Update Key</h3>
                            <div className="flex gap-4">
                                <select
                                    value={newKey.platform}
                                    onChange={e => setNewKey({ ...newKey, platform: e.target.value })}
                                    className="bg-slate-800 border border-slate-700 rounded-lg px-4 py-3"
                                >
                                    {platforms.map(p => (
                                        <option key={p.id} value={p.id}>{p.name}</option>
                                    ))}
                                </select>
                                <input
                                    type="password"
                                    value={newKey.api_key}
                                    onChange={e => setNewKey({ ...newKey, api_key: e.target.value })}
                                    placeholder="Enter API key..."
                                    className="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-4 py-3"
                                />
                                <button onClick={saveKey} disabled={saving || !newKey.api_key} className="btn-primary px-6 py-3 rounded-lg font-medium disabled:opacity-50">
                                    {saving ? 'Saving...' : 'Save Key'}
                                </button>
                            </div>
                        </div>
                        
                        <div className="glass rounded-2xl p-6">
                            <h3 className="font-semibold mb-4">Where to Get API Keys</h3>
                            <div className="space-y-3 text-sm">
                                <p><span className="text-slate-400">OpenAI:</span> <a href="https://platform.openai.com/api-keys" target="_blank" className="text-sky-400 hover:underline">platform.openai.com/api-keys</a></p>
                                <p><span className="text-slate-400">Google AI:</span> <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-sky-400 hover:underline">aistudio.google.com/app/apikey</a></p>
                                <p><span className="text-slate-400">Anthropic:</span> <a href="https://console.anthropic.com/settings/keys" target="_blank" className="text-sky-400 hover:underline">console.anthropic.com/settings/keys</a></p>
                                <p><span className="text-slate-400">Perplexity:</span> <a href="https://www.perplexity.ai/settings/api" target="_blank" className="text-sky-400 hover:underline">perplexity.ai/settings/api</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                if (api.token) {
                    api.get('/auth/me').then(setUser).catch(() => {
                        api.token = null;
                        localStorage.removeItem('token');
                    }).finally(() => setLoading(false));
                } else {
                    setLoading(false);
                }
            }, []);
            
            const handleLogout = () => {
                api.token = null;
                localStorage.removeItem('token');
                setUser(null);
            };
            
            if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="text-xl">Loading...</div></div>;
            if (!user) return <LoginPage onLogin={setUser} />;
            return <Dashboard user={user} onLogout={handleLogout} />;
        };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
